<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Parallel processing &mdash; FancyPipe 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/site.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="FancyPipe 1.0 documentation" href="index.html" />
    <link rel="next" title="Classes and methods" href="classesmethods.html" />
    <link rel="prev" title="Creating a FancyPipe program" href="parallelprogramming.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="classesmethods.html" title="Classes and methods"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parallelprogramming.html" title="Creating a FancyPipe program"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FancyPipe 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/fancypipelogo.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Parallel processing</a><ul>
<li><a class="reference internal" href="#multi-threading-multi-processing-and-distributed-processing">Multi-threading, multi-processing, and distributed processing</a><ul>
<li><a class="reference internal" href="#multi-threading">Multi-threading</a></li>
<li><a class="reference internal" href="#multi-processing">Multi-processing</a></li>
<li><a class="reference internal" href="#distributed-processing">Distributed processing</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parallelprogramming.html"
                        title="previous chapter">Creating a FancyPipe program</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="classesmethods.html"
                        title="next chapter">Classes and methods</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/parallelprocessing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="parallel-processing">
<h1>Parallel processing<a class="headerlink" href="#parallel-processing" title="Permalink to this headline">¶</a></h1>
<p>FancyPipe analyses the serial/parallel alignment of your tasks on the
fly in a bottom-up fashion. It starts at the output of the task whose
run() method is called. Typically, the outputs contain dependencies on
tasks defined inside main().
These tasks themselves may have dependencies on other tasks etc. etc.
FancyPipe works its way up through the dependency graph until it
encounters a task for which the input is fully specified.
It submits this task to the <em>job queue</em> and continues to find
other ready-to-run tasks. Meanwhile, an array of worker nodes is waiting
for jobs to appear in the queue. Upon completion, the worker node
submits the result to a <em>result queue</em>. The main process listens to this
queue, and feeds the result to tasks that need it as input.
This continues until all requested outputs of the outer task are
computed.</p>
<div class="section" id="multi-threading-multi-processing-and-distributed-processing">
<h2>Multi-threading, multi-processing, and distributed processing<a class="headerlink" href="#multi-threading-multi-processing-and-distributed-processing" title="Permalink to this headline">¶</a></h2>
<p>FancyPipe supports three modes of parallel operations, which can be
specified as a command line option. For the code it does not
matter which parallelization option is chosen: for debugging you can
use multi-threading or multi-processing on a laptop, and for production
you can employ a distributed processing cluster.</p>
<div class="section" id="multi-threading">
<h3>Multi-threading<a class="headerlink" href="#multi-threading" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to run jobs in parallel is to setup a pool of
<em>worker threads</em> on a multi-processor workstation. This is a good
solution if the tasks consist mainly of calls to external programs.
If the tasks run mainly python code, then multi-threading will suffer
from python&#8217;s <em>Global Interpreter Lock</em>, which allows only one thread to
run the python interpreter at a time.</p>
<p>The option &#8220;-workertype=T&#8221; invokes multi-threading.</p>
<p>The option &#8220;-numworkers=X&#8221; creates X worker threads. By default, one
thread per cpu is created.</p>
</div>
<div class="section" id="multi-processing">
<h3>Multi-processing<a class="headerlink" href="#multi-processing" title="Permalink to this headline">¶</a></h3>
<p>To run tasks that run pure python code in parallel, the better solution
is to create a separate proces (=python interpreter) for each parallel
task. This requires more overhead and memory than multi-threading, as it
involves serializing and copying the input and output data of the tasks.
This all happens behind the scenes.</p>
<p>The option &#8220;-workertype=P&#8221; invokes multi-processing.</p>
<p>The option &#8220;-numworkers=X&#8221; creates X worker processes. By default, one
process per cpu is created.</p>
</div>
<div class="section" id="distributed-processing">
<h3>Distributed processing<a class="headerlink" href="#distributed-processing" title="Permalink to this headline">¶</a></h3>
<p>The previous options are restricted to a single multi-core workstation.
Distributed processing involved multiple workstations, grid nodes, or
virtual machine instances in a cloud environment. In this setup, there
are three players:</p>
<ul class="simple">
<li>the <em>client</em>, who submits a large job to the <em>manager</em>.</li>
<li>the <em>manager</em>, who distributes the job to the <em>worker nodes</em> and
returns the result to the client.</li>
<li>the <em>worker node</em>, who takes jobs and returns results to the <em>manager</em>.</li>
</ul>
<p>Each player can reside on the same or on separate machines, as long as:</p>
<ul class="simple">
<li>the client and worker nodes have internet (tcp) access to the
manager.</li>
<li>the client and worker nodes have access to a shared filesystem, in
which the working directory (-tempdir) and all other files used
by the pipeline must reside.</li>
<li>the same version of python and libraries used by the pipeline are
available on the client and worker nodes.</li>
<li>the manager&#8217;s machine has a tcp-port available that is not
blocked by a firewall.</li>
</ul>
<p>First test distributed processing on a single machine, this does not
require a shared filesystem:</p>
<ol class="arabic simple">
<li>Start the manager by running</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>python fancymanager.py &amp;
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Start the workers by running</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>python fancyworker.py -jobmanager=localhost &amp;
</pre></div>
</div>
<p>Optionally you can set -numworkers=X if you want fewer workers than the cpu-count.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Start the client by running your pipeline with the option: -jobmanager=localhost</li>
</ol>
<p>To terminate the manager and workers, use (on Linux):</p>
<div class="highlight-python"><div class="highlight"><pre>killall python
</pre></div>
</div>
<p>Next, setup distributed processing on multiple machines. As an example, let&#8217;s use three machines
with ip addresses ipA, ipB and ipC, and available port 5432 on ipA:</p>
<ol class="arabic simple">
<li>Setup the shared filesystem on machines A, B and C.</li>
<li>Start the manager by running on machine A</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>python fancymanager.py -jobmanager=ipA:5432 &amp;
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Start the workers by running</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>On machine A: python fancyworker.py -jobmanager=ipA:5432 &amp;
On machine B: python fancyworker.py -jobmanager=ipA:5432 &amp;
On machine C: python fancyworker.py -jobmanager=ipA:5432 &amp;
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>On machine A (or B or C), start the client by running your pipeline with the option: -jobmanager=ipA:5432</li>
</ol>
<p>The manager machine needs no python modules or shared filesystem, since
all that the manager does is to relay jobs and results between
client and workers.</p>
<p>Be aware that this setup is only suitable for a private network, because
anyone who has access to the manager can submit jobs to it. You can add a
bit of security by adding the parameter -jobauth=SECRET to all
commands that use the -jobmanager option, whereby SECRET must be replaced
by a hard-to-guess string.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="classesmethods.html" title="Classes and methods"
             >next</a> |</li>
        <li class="right" >
          <a href="parallelprogramming.html" title="Creating a FancyPipe program"
             >previous</a> |</li>
        <li><a href="index.html">FancyPipe 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Rembrandt Bakker.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>